library(pense)
library(mmlasso)
n <- 80
p <- 50
set.seed(123)
x <- matrix(rnorm(n*p), n, p)
y <- as.vector( x %*% c(rep(7, 5), rep(0, p-5))) + rnorm(n, sd=.5)
a <- list(delta=0.2584052, lamda=11.42803)
system.time(
  b1 <- pense(X=x, y=y, alpha=0, standardize=TRUE, options=pense_options(delta=a$delta))
)


summary(b1$lambda)
b1$lambda_opt
as.vector(b1$coeff[, b1$lambda == b1$lambda_opt])
b1$scale[b1$lambda == b1$lambda_opt]



# Gaby Mac OS
# > summary(b1$lambda)
# Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
# 0.0019    0.0610    1.9340  155.9000   60.9800 1915.0000 
# 
# > b1$lambda_opt
# [1] 0.007840282
# 
# > as.vector(b1$coeff[, b1$lambda == b1$lambda_opt])
# [1]  0.23084418  6.93767228  5.67058647  5.91316788  4.17462528  5.07903788  1.13236196
# [8] -0.03737224  0.37165934 -0.05866258  0.61299399  0.53911003  0.38516843 -0.05908220
# [15]  0.88976140 -0.20383908 -2.51557997  0.85916872 -0.27093824  1.09553660 -0.49816271
# [22] -0.08186587  0.39310352 -0.99027369 -0.27164453  0.65720140 -2.31705492 -0.76842638
# [29] -1.10385679  0.99761589  0.69827730  0.12645148 -1.01400209 -0.95892976  0.08896191
# [36] -0.72333831  0.42717294  0.05557750  0.77511164 -0.58050942 -0.57708320 -0.59644456
# [43]  0.44732838  1.43877525 -0.78837925  0.08815706 -0.01636434 -1.19245222 -0.26624889
# [50] -0.35181924  0.34721069
# 
# > b1$scale[b1$lambda == b1$lambda_opt]
# [1] 0.513307

# David OS
# > summary(b1$lambda)
# Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
# 0.0019    0.0610    1.9337  155.8592   60.9775 1914.6384 
# > b1$lambda_opt
# [1] 0.007840282
# > coef(b1, correction = FALSE)
# [1]  0.23084418  6.93767228  5.67058647  5.91316788  4.17462528  5.07903788  1.13236196 -0.03737224  0.37165934 -0.05866258  0.61299399  0.53911003
# [13]  0.38516843 -0.05908220  0.88976140 -0.20383908 -2.51557997  0.85916872 -0.27093824  1.09553660 -0.49816271 -0.08186587  0.39310352 -0.99027369
# [25] -0.27164453  0.65720140 -2.31705492 -0.76842638 -1.10385679  0.99761589  0.69827730  0.12645148 -1.01400209 -0.95892976  0.08896191 -0.72333831
# [37]  0.42717294  0.05557750  0.77511164 -0.58050942 -0.57708320 -0.59644456  0.44732838  1.43877525 -0.78837925  0.08815706 -0.01636434 -1.19245222
# [49] -0.26624889 -0.35181924  0.34721069
# > b1$scale[b1$lambda == b1$lambda_opt]
# [1] 0.513307

# Windows David
# > summary(b1$lambda)
# Min.   1st Qu.    Median      Mean   3rd Qu.      Max.
# 0.0019    0.0610    1.9337  155.8592   60.9775 1914.6384
# > b1$lambda_opt
# [1] 0.007840282
# > coef(b1, correction = FALSE)
# [1]  0.23084418  6.93767228  5.67058647  5.91316788  4.17462528  5.07903788
# [7]  1.13236196 -0.03737224  0.37165934 -0.05866258  0.61299399  0.53911003
# [13]  0.38516843 -0.05908220  0.88976140 -0.20383908 -2.51557997  0.85916872
# [19] -0.27093824  1.09553660 -0.49816271 -0.08186587  0.39310352 -0.99027369
# [25] -0.27164453  0.65720140 -2.31705492 -0.76842638 -1.10385679  0.99761589
# [31]  0.69827730  0.12645148 -1.01400209 -0.95892976  0.08896191 -0.72333831
# [37]  0.42717294  0.05557750  0.77511164 -0.58050942 -0.57708320 -0.59644456
# [43]  0.44732838  1.43877525 -0.78837925  0.08815706 -0.01636434 -1.19245222
# [49] -0.26624889 -0.35181924  0.34721069
# > b1$scale[b1$lambda == b1$lambda_opt]
# [1] 0.513307

# Matias Windows
# 26: In pen_s_reg(std_data$xs, std_data$yc, alpha = alpha,  ... :
#                    PENSE did not converge for lambda = 0.001481
# 43: In pen_s_reg(std_data$xs, std_data$yc, alpha = alpha,  ... :
#                    PENSE did not converge for lambda = 0.006063
# 50: In pen_s_reg(std_data$xs, std_data$yc, alpha = alpha,  ... :
#                    PENSE did not converge for lambda = 2.996400

# > summary(b1$lambda)
# Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
# 0.0019    0.0610    1.9337  155.8592   60.9775 1914.6384 
# > b1$lambda_opt
# [1] 0.007840282
# > as.vector(b1$coeff[, b1$lambda == b1$lambda_opt])
# [1]  0.23084418  6.93767228  5.67058647  5.91316788  4.17462528  5.07903788  1.13236196 -0.03737224  0.37165934
# [10] -0.05866258  0.61299399  0.53911003  0.38516843 -0.05908220  0.88976140 -0.20383908 -2.51557997  0.85916872
# [19] -0.27093824  1.09553660 -0.49816271 -0.08186587  0.39310352 -0.99027369 -0.27164453  0.65720140 -2.31705492
# [28] -0.76842638 -1.10385679  0.99761589  0.69827730  0.12645148 -1.01400209 -0.95892976  0.08896191 -0.72333831
# [37]  0.42717294  0.05557750  0.77511164 -0.58050942 -0.57708320 -0.59644456  0.44732838  1.43877525 -0.78837925
# [46]  0.08815706 -0.01636434 -1.19245222 -0.26624889 -0.35181924  0.34721069
# > b1$scale[b1$lambda == b1$lambda_opt]
# [1] 0.513307

# Matias Linux
# 6: In pen_s_reg(std_data$xs, std_data$yc, alpha = alpha,  ... :
# PENSE did not converge for lambda = 1.704911
# 7: In pen_s_reg(std_data$xs, std_data$yc, alpha = alpha,  ... :
# PENSE did not converge for lambda = 2.996400
# 12: In pen_s_reg(std_data$xs, std_data$yc, alpha = alpha,  ... :
# PENSE did not converge for lambda = 0.001481
# 13: In pen_s_reg(std_data$xs, std_data$yc, alpha = alpha,  ... :
# PENSE did not converge for lambda = 0.001481
# 15: In pen_s_reg(std_data$xs, std_data$yc, alpha = alpha,  ... :
# PENSE did not converge for lambda = 0.006063

# > summary(b1$lambda)
# Min.   1st Qu.    Median      Mean   3rd Qu.      Max.
# 0.0019    0.0610    1.9340  155.9000   60.9800 1915.0000
# > b1$lambda_opt
# [1] 0.007840282
# > as.vector(b1$coeff[, b1$lambda == b1$lambda_opt])
# [1]  0.23084418  6.93767228  5.67058647  5.91316788  4.17462528  5.07903788
# [7]  1.13236196 -0.03737224  0.37165934 -0.05866258  0.61299399  0.53911003
# [13]  0.38516843 -0.05908220  0.88976140 -0.20383908 -2.51557997  0.85916872
# [19] -0.27093824  1.09553660 -0.49816271 -0.08186587  0.39310352 -0.99027369
# [25] -0.27164453  0.65720140 -2.31705492 -0.76842638 -1.10385679  0.99761589
# [31]  0.69827730  0.12645148 -1.01400209 -0.95892976  0.08896191 -0.72333831
# [37]  0.42717294  0.05557750  0.77511164 -0.58050942 -0.57708320 -0.59644456
# [43]  0.44732838  1.43877525 -0.78837925  0.08815706 -0.01636434 -1.19245222
# [49] -0.26624889 -0.35181924  0.34721069
# > b1$scale[b1$lambda == b1$lambda_opt]
# [1] 0.513307



a <- sridge(x=x, y=y, cualcv.S=5, numlam.S=30, niter.S=50, normin=0,
            denormout=0, alone=1, ncores=4)
a$coef
a$lamda/nrow(x)
a$delta
a$scale

# Matias Windows
# > a$coef
# [1]  0.56393725  4.93835073  4.52520916  4.81057373  4.02522828  3.38954222 -0.24710486 -0.76467020  0.18671219
# [10]  0.82159307  0.87416926  1.01648880  1.45493286 -0.05151432  1.48146142 -0.66388817 -0.60210763  0.27785843
# [19]  0.30947435  0.26140655 -0.84834424 -0.82912644  0.71738652 -0.37778783  0.17111429 -0.25918776 -0.73510224
# [28]  0.33117573 -0.65798889 -0.29323547 -0.01326912  0.96685920 -0.45921634 -0.49199308  1.14162844  0.29633986
# [37]  0.97414776 -0.67190607  1.74029930 -0.71029622  0.80130134  0.33768376 -0.29952025  0.58196743 -0.29347014
# [46] -0.11529802  2.05014463 -1.43114321  0.91086385  1.00114588 -0.04155250
# > a$lamda/nrow(x)
# [1] 0.1428504
# > a$delta
# [1] 0.2584052
# > a$scale
# [1] 3.120395


# The classical methods work 
detach(package:pense)
library(glmnet)
d <- glmnet(x=x, y=y, alpha=0, family='gaussian', standardize=TRUE, intercept=TRUE)
d2 <- cv.glmnet(x=x, y=y, alpha=0, nfolds=5, family='gaussian', standardize=TRUE, intercept=TRUE)
as.vector(coef(d2, s='lambda.min') )

# [1] -0.44758993  6.84071517  6.43792473  6.11671099  5.80955408  5.63654031  0.27685178  0.18691536  0.22341984
# [10]  0.21037653  0.31719134  0.12330850  0.35881440 -0.18028603  0.26846078 -0.06692925 -0.21768027  0.10069179
# [19] -0.30636298  0.38365965 -0.16083863  0.07292750 -0.06625486 -0.37753467 -0.25670810  0.43897691 -0.76350800
# [28] -0.43616188 -0.20168467 -0.32243167 -0.14685351  0.28685218 -0.11230243  0.24661119 -0.06925378  0.12252345
# [37]  0.50052367  0.24918111  0.43636937 -0.31912413 -0.32392971 -0.34499128  0.16741021  0.16953670 -0.24950992
# [46]  0.04629432  0.29358932 -0.59842793 -0.44200748  0.15908943  0.02100474
# 


## Another example

library(pense)
library(mmlasso)
n <- 200
p <- 20
set.seed(123)
x <- matrix(rnorm(n*p), n, p)
y <- as.vector( x %*% c(rep(7, 5), rep(0, p-5))) + rnorm(n, sd=.5)

a <- sridge(x=x, y=y, cualcv.S=5, numlam.S=30, niter.S=50, normin=0,
            denormout=0, alone=1, ncores=4)
a$coef
a$lamda/nrow(x)
a$delta
a$scale
# [1] -0.027220008  6.850533931  6.943428188  6.936678378  6.956024451  6.931821779  0.147890476 -0.052458886
# [9] -0.147172629  0.057515955 -0.111114625  0.030983391  0.117933443  0.030969896  0.058200235 -0.100918005
# [17]  0.011192555  0.003500197  0.057711474 -0.009582772  0.009584368
# > a$lamda/nrow(x)
# [1] 0
# > a$delta
# [1] 0.45
# > a$scale
# [1] 0.4342332
# a <- list(delta=0.45, lamda=0)
system.time(
  b1 <- pense(X=x, y=y, alpha=0, standardize=TRUE, options=pense_options(delta=a$delta))
)
summary(b1$lambda)
b1$lambda_opt
as.vector(b1$coeff[, b1$lambda == b1$lambda_opt])
b1$scale[b1$lambda == b1$lambda_opt]
# > summary(b1$lambda)
# Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
# 0.0017    0.0527    1.6711  134.6917   52.6960 1654.6085 
# > b1$lambda_opt
# [1] 0.001654608
# > as.vector(b1$coeff[, b1$lambda == b1$lambda_opt])
# [1] -0.024621146  6.835710224  6.931570779  6.921398813  6.938026329  6.912988312  0.151423232 -0.041728633
# [9] -0.152202777  0.056871381 -0.106894496  0.028029696  0.114604582  0.028059891  0.053877473 -0.105659977
# [17]  0.007557802  0.005520520  0.054491244 -0.005099722  0.011141993
# > b1$scale[b1$lambda == b1$lambda_opt]
# [1] 0.4001488

detach(package:pense)
library(glmnet)
d <- glmnet(x=x, y=y, alpha=0, family='gaussian', standardize=TRUE, intercept=TRUE)
d2 <- cv.glmnet(x=x, y=y, alpha=0, nfolds=5, family='gaussian', standardize=TRUE, intercept=TRUE)
as.vector(coef(d2, s='lambda.min') )
# [1]  0.010744352  6.559880285  6.601623584  6.501857526  6.561816955  6.486271087 -0.009057834  0.087287285
# [9]  0.004966279 -0.013775230  0.048413559  0.056674569  0.003621493  0.028778229  0.031249438 -0.063337938
# [17] -0.034989798 -0.031608346 -0.010143689 -0.063172706 -0.007735024
# > d2$lambda.min
# [1] 0.929791
